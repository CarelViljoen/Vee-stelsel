
import React from "react";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { TrendingUp, PawPrint, BarChart3 } from "lucide-react";

export default function TellingStats({ tellings, kampe }) {
  const getTotaleSkape = () => {
    if (tellings.length === 0) return 0;
    
    // Kry die mees onlangse telling per kamp
    const kampTellings = {};
    tellings.forEach(telling => {
      if (!kampTellings[telling.kamp_id] || 
          new Date(telling.datum) > new Date(kampTellings[telling.kamp_id].datum)) {
        kampTellings[telling.kamp_id] = telling;
      }
    });
    
    return Object.values(kampTellings).reduce((total, telling) => 
      total + (telling.aantal_skape || 0), 0);
  };

  const getGemiddeldPerKamp = () => {
    const totaal = getTotaleSkape();
    const aktieweKampe = kampe.filter(k => k.status === 'aktief').length;
    return aktieweKampe > 0 ? Math.round(totaal / aktieweKampe) : 0;
  };

  const getOnlangseGemiddeld = () => {
    if (tellings.length === 0) return 0;
    const onlangse5 = tellings.slice(0, 5);
    const totaal = onlangse5.reduce((sum, t) => sum + t.aantal_skape, 0);
    return Math.round(totaal / onlangse5.length);
  };

  return (
    <div className="space-y-6">
      <Card className="shadow-lg bg-white/80 backdrop-blur-sm">
        <CardHeader className="p-6 border-b border-stone-100">
          <CardTitle className="flex items-center gap-2 text-xl font-bold text-stone-800">
            <BarChart3 className="w-5 h-5 text-emerald-500" />
            Statistieke
          </CardTitle>
        </CardHeader>
        <CardContent className="p-6">
          <div className="space-y-6">
            <div className="text-center p-4 bg-gradient-to-r from-emerald-50 to-blue-50 rounded-xl">
              <PawPrint className="w-8 h-8 mx-auto mb-2 text-emerald-600" />
              <p className="text-sm text-stone-600 mb-1">Totale Skape</p>
              <p className="text-3xl font-bold text-stone-800">{getTotaleSkape().toLocaleString()}</p>
            </div>

            <div className="grid grid-cols-1 gap-4">
              <div className="p-4 border border-stone-200 rounded-xl">
                <div className="flex items-center gap-2 mb-2">
                  <TrendingUp className="w-4 h-4 text-blue-500" />
                  <span className="text-sm font-semibold text-stone-700">Gemiddeld per Kamp</span>
                </div>
                <p className="text-2xl font-bold text-stone-800">{getGemiddeldPerKamp()}</p>
              </div>

              <div className="p-4 border border-stone-200 rounded-xl">
                <div className="flex items-center gap-2 mb-2">
                  <BarChart3 className="w-4 h-4 text-purple-500" />
                  <span className="text-sm font-semibold text-stone-700">Onlangse Gemiddeld</span>
                </div>
                <p className="text-2xl font-bold text-stone-800">{getOnlangseGemiddeld()}</p>
              </div>
            </div>

            <div className="p-4 bg-amber-50 rounded-xl">
              <h4 className="font-semibold text-stone-800 mb-2">Telling Opsomming</h4>
              <div className="space-y-2 text-sm">
                <div className="flex justify-between">
                  <span className="text-stone-600">Totale Tellings:</span>
                  <span className="font-semibold">{tellings.length}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-stone-600">Aktiewe Kampe:</span>
                  <span className="font-semibold">{kampe.filter(k => k.status === 'aktief').length}</span>
                </div>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
