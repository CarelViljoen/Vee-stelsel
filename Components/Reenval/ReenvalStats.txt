import React from "react";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Cloud, TrendingUp } from "lucide-react";
import { format, startOfMonth, endOfMonth, startOfYear, endOfYear } from "date-fns";
import { af } from "date-fns/locale";

export default function ReenvalStats({ reenvals, plase }) {

  const getReenvalVirPeriode = (entries, startDate, endDate) => {
    return entries.filter(r => {
      const date = new Date(r.datum);
      return date >= startDate && date <= endDate;
    });
  };

  const getTotaleReenval = (entries) => {
    return entries.reduce((total, r) => total + (r.reenval_mm || 0), 0);
  };
  
  const getReenvalStatus = (mm) => {
    if (mm < 10) return { status: "Laag", color: "text-red-600", bg: "bg-red-50" };
    if (mm < 50) return { status: "Normaal", color: "text-yellow-600", bg: "bg-yellow-50" };
    if (mm < 100) return { status: "Goed", color: "text-green-600", bg: "bg-green-50" };
    return { status: "Uitstekend", color: "text-blue-600", bg: "bg-blue-50" };
  };

  return (
    <Card className="shadow-lg bg-white/80 backdrop-blur-sm">
      <CardHeader className="p-6 border-b border-stone-100">
        <CardTitle className="flex items-center gap-2 text-xl font-bold text-stone-800">
          <Cloud className="w-5 h-5 text-blue-500" />
          Reenval Opsomming
        </CardTitle>
      </CardHeader>
      <CardContent className="p-6">
        <div className="grid md:grid-cols-2 gap-8">
          {plase.map(plaas => {
            const plaasReenvals = reenvals.filter(r => r.plaas_id === plaas.id);
            const now = new Date();
            const maandReenval = getReenvalVirPeriode(plaasReenvals, startOfMonth(now), endOfMonth(now));
            const jaarReenval = getReenvalVirPeriode(plaasReenvals, startOfYear(now), endOfYear(now));

            const maandTotaal = getTotaleReenval(maandReenval);
            const jaarTotaal = getTotaleReenval(jaarReenval);
            
            const maandStatus = getReenvalStatus(maandTotaal);
            const jaarStatus = getReenvalStatus(jaarTotaal);

            return (
              <div key={plaas.id} className="space-y-6">
                <h3 className="text-lg font-semibold text-center text-stone-700 border-b pb-2">{plaas.naam}</h3>
                
                {/* Hierdie Maand */}
                <div className={`p-4 rounded-xl ${maandStatus.bg}`}>
                  <div className="text-center">
                    <h4 className="font-semibold text-stone-800 mb-2">
                      {format(now, 'MMMM yyyy', { locale: af })}
                    </h4>
                    <p className="text-3xl font-bold mb-1 text-stone-800">{maandTotaal.toFixed(1)}mm</p>
                    <p className={`text-sm font-medium ${maandStatus.color}`}>{maandStatus.status}</p>
                    <p className="text-xs text-stone-600 mt-1">{maandReenval.length} entries</p>
                  </div>
                </div>

                {/* Hierdie Jaar */}
                <div className={`p-4 rounded-xl ${jaarStatus.bg}`}>
                  <div className="text-center">
                    <h4 className="font-semibold text-stone-800 mb-2">
                      {format(now, 'yyyy', { locale: af })} Totaal
                    </h4>
                    <p className="text-3xl font-bold mb-1 text-stone-800">{jaarTotaal.toFixed(1)}mm</p>
                    <p className={`text-sm font-medium ${jaarStatus.color}`}>{jaarStatus.status}</p>
                    <p className="text-xs text-stone-600 mt-1">{jaarReenval.length} entries</p>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </CardContent>
    </Card>
  );
}